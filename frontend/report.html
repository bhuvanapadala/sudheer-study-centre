<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reports - Sudheer Study Centre</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #f9fafb;
      color: #333;
    }

    .main-heading {
      background-color: #4b0082;
      color: #fff;
      padding: 20px;
      text-align: center;
      font-size: 2.2rem;
      font-weight: bold;
    }

  

    .navbar {
      display: flex;
      justify-content: center;
      gap: 20px;
      background-color: #eee;
      padding: 15px 10px;
      flex-wrap: wrap;
    }

    .navbar a {
      background-color: #4b0082;
      color: #fff;
      padding: 10px 20px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 500;
      transition: background 0.3s ease;
    }

    .navbar a:hover,
    .navbar a.active {
      background-color: #9370db;
    }

    h1 {
      text-align: center;
      margin: 20px 0;
      color: #1571cc;
    }

    .summary-cards {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .card {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      flex: 1 1 220px;
    }

    .card h3 {
      margin: 0 0 10px;
      color: #555;
    }

    .card p {
      font-size: 20px;
      font-weight: bold;
      color: #111;
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: center;
      margin: 20px auto;
      padding: 10px;
      background-color: #f0f4f8;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      max-width: 900px;
    }

    .filters input,
    .filters select {
      padding: 10px 15px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
      flex: 1;
      min-width: 150px;
      max-width: 250px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    th, td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    th {
      background: #2b2e4a;
      color: #fff;
    }

    tr:hover {
      background: #f1f1f1;
    }

    .paid {
      color: green;
      font-weight: bold;
    }

    .unpaid {
      color: red;
      font-weight: bold;
    }

    .print-btn {
      padding: 10px 20px;
      background: #2b2e4a;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 10px auto 20px;
      display: block;
    }

    @media (max-width: 768px) {
      .summary-cards {
        flex-direction: row;
        align-items: center;
      }
    }

    .footer {
  text-align: center;
  padding: 15px;
  background-color: #f8f8f8;
  color: #333;
  font-size: 14px;
  margin-top: 40px;
  border-top: 1px solid #ddd;
}

.footer p {
  margin: 0;
}

  </style>
</head>
<body>
  <header style="display: flex; align-items: center; justify-content: space-between; padding: 10px; background-color: #4b0082; color: white;">
  <div class="main-heading">
    Sudheer Study Centre
  </div>

  <div class="profile-dropdown" style="position: relative;">
    <img src="https://ui-avatars.com/api/?name=SS&background=ffffff&color=000000&rounded=true&size=40" alt="Profile" class="profile-icon" style="width: 40px; height: 40px; border-radius: 50%; cursor: pointer;" />

    <div class="profile-menu" style="display: none; position: absolute; right: 0; background: white; color: black; box-shadow: 0 4px 8px rgba(0,0,0,0.2); border-radius: 8px; padding: 10px; margin-top: 8px; min-width: 100px; z-index: 100;">
      <a href="#" id="logoutBtn" style="display: block; padding: 8px; text-decoration: none; color: #4b0082;">Logout</a>
    </div>
  </div>
</header>

  <div class="navbar">
    <a href="index.html">Dashboard</a>
    <a href="students.html">Students</a>
    <a href="fees.html">Fees</a>
    <a href="report.html" class="active">Reports</a>
  </div>

  <h1>Monthly Fee Report</h1>
  <button class="print-btn" onclick="window.print()">üñ®Ô∏è Print Report</button>

  <div class="summary-cards">
    <div class="card"><h3>Total Fees Collected</h3><p id="totalCollected">‚Çπ0</p></div>
    <div class="card"><h3>Total Pending Fees</h3><p id="totalPending">‚Çπ0</p></div>
    <div class="card"><h3>Paid Students</h3><p id="paidCount">0</p></div>
    <div class="card"><h3>Unpaid Students</h3><p id="unpaidCount">0</p></div>
  </div>

  <div class="filters">
    <input type="text" id="searchInput" placeholder="Search by name...">
    <select id="filterSchool">
      <option value="">All Schools</option>
      <option>Sudheer Kids School</option>
      <option>Sudheer EM School</option>
      <option>Pragati Vidya Niketan</option>
      <option>Government School</option>
      <option>Minerva EM School</option>
      <option>Aditya EM School</option>
      <option>St.Ann's School</option>
      <option>Sri Shirdi Sai Vidya Niketan</option>
      <option>Dafne</option>
      <option>Rajamahendri International School</option>
      <option>Delhi Public School</option>
      <option>Future Kids School</option>
      <option>Dreams School</option>
      <option>SR School</option>
      <option>Other</option>
    </select>

    <select id="filterPlace">
      <option value="">All Places</option>
      <option>Kadiyapulanka</option>
      <option>Burrilanka</option>
    </select>

    <select id="filterYear">
      <option value="">All Years</option>
      <option>2023</option>
      <option>2024</option>
      <option>2025</option>
      <option>2026</option>
      <option>2027</option>
      <option>2028</option>
      <option>2029</option>
      <option>2030</option>
    </select>

    <select id="monthSelect">
      <option value="">All Months</option>
      <option value="Jan">January</option>
      <option value="Feb">February</option>
      <option value="Mar">March</option>
      <option value="Apr">April</option>
      <option value="May">May</option>
      <option value="Jun">June</option>
      <option value="Jul">July</option>
      <option value="Aug" selected>August</option>
      <option value="Sep">September</option>
      <option value="Oct">October</option>
      <option value="Nov">November</option>
      <option value="Dec">December</option>
    </select>
  </div>

  <table id="reportTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>School</th>
        <th>Place</th>
        <th>Monthly Fee</th>
        <th>Status</th>
        <th>Pending</th>
      </tr>
    </thead>
    <tbody id="reportBody"></tbody>
  </table>
  <footer class="footer">
  <p>&copy; 2025 Sudheer Study Centre. All rights reserved. | Designed by Bhuvana Padala</p>
</footer>


<script>
  const API_URL = 'https://elsa-backend.onrender.com/api/students';

  if (localStorage.getItem('loggedIn') !== 'true') {
    window.location.href = 'login.html';
  }

  // Set defaults for filters
  const monthSelect = document.getElementById('monthSelect');
  const yearSelect = document.getElementById('filterYear');

  // Load last selected filters from localStorage (if available)
  const savedMonth = localStorage.getItem('selectedMonth');
  const savedYear = localStorage.getItem('selectedYear');

  if (savedMonth) {
    monthSelect.value = savedMonth;
  } else {
    const currentMonthName = new Date().toLocaleString('default', { month: 'long' });
    monthSelect.value = currentMonthName;
    localStorage.setItem('selectedMonth', currentMonthName);
  }

  if (savedYear) {
    yearSelect.value = savedYear;
  } else {
    const currentYear = new Date().getFullYear().toString();
    yearSelect.value = currentYear;
    localStorage.setItem('selectedYear', currentYear);
  }

  let students = [];

  async function loadStudents() {
    try {
      const res = await fetch(API_URL);
      const data = await res.json();
      students = data;
      loadReportData();
    } catch (err) {
      console.error("Error loading students:", err);
    }
  }

  function loadReportData() {
    const tbody = document.getElementById('reportBody');
    tbody.innerHTML = '';

    const search = document.getElementById('searchInput').value.toLowerCase();
    const filterSchool = document.getElementById('filterSchool').value;
    const filterPlace = document.getElementById('filterPlace').value;
    const selectedMonth = monthSelect.value;
    const selectedYear = yearSelect.value;

    // Save to localStorage so filters persist after refresh
    localStorage.setItem('selectedMonth', selectedMonth);
    localStorage.setItem('selectedYear', selectedYear);

    let totalCollected = 0;
    let totalPending = 0;
    let paidCount = 0;
    let unpaidCount = 0;

    students.forEach(s => {
      const monthNumber = new Date(`${selectedMonth} 1, ${selectedYear}`).getMonth() + 1;
      const paid = s.feesPaid?.[selectedYear]?.[monthNumber]?.paid === true;

      const matchesSearch = s.name.toLowerCase().includes(search);
      const matchesSchool = !filterSchool || s.school === filterSchool;
      const matchesPlace = !filterPlace || s.place === filterPlace;

      if (matchesSearch && matchesSchool && matchesPlace) {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${s.name}</td>
          <td>${s.school}</td>
          <td>${s.place}</td>
          <td>‚Çπ${s.fee}</td>
          <td class="${paid ? 'paid' : 'unpaid'}">${paid ? 'Paid' : 'Unpaid'}</td>
          <td>${paid ? '‚Çπ0' : `‚Çπ${s.fee}`}</td>
        `;
        tbody.appendChild(row);

        if (paid) {
          totalCollected += s.fee;
          paidCount++;
        } else {
          totalPending += s.fee;
          unpaidCount++;
        }
      }
    });

    document.getElementById('totalCollected').textContent = `‚Çπ${totalCollected}`;
    document.getElementById('totalPending').textContent = `‚Çπ${totalPending}`;
    document.getElementById('paidCount').textContent = paidCount;
    document.getElementById('unpaidCount').textContent = unpaidCount;
  }

  // Event listeners
  document.getElementById('searchInput').addEventListener('input', loadReportData);
  document.getElementById('filterSchool').addEventListener('change', loadReportData);
  document.getElementById('filterPlace').addEventListener('change', loadReportData);
  document.getElementById('filterYear').addEventListener('change', () => {
    localStorage.setItem('selectedYear', yearSelect.value);
    loadReportData();
  });
  document.getElementById('monthSelect').addEventListener('change', () => {
    localStorage.setItem('selectedMonth', monthSelect.value);
    loadReportData();
  });

  // Initial load
  loadStudents();

  // Profile menu & logout
  const profileIcon = document.querySelector('.profile-icon');
  const profileMenu = document.querySelector('.profile-menu');
  const logoutBtn = document.getElementById('logoutBtn');

  profileIcon.addEventListener('click', () => {
    profileMenu.style.display = profileMenu.style.display === 'block' ? 'none' : 'block';
  });

  logoutBtn.addEventListener('click', (e) => {
    e.preventDefault();
    localStorage.removeItem('loggedIn');
    window.location.href = "login.html";
  });

  document.addEventListener('click', (e) => {
    if (!e.target.closest('.profile-dropdown')) {
      profileMenu.style.display = 'none';
    }
  });
</script>


</body>
</html>
